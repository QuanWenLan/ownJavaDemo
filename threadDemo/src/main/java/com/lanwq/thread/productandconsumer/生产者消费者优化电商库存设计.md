
电商系统中经常会有抢购活动，在这类促销活动中，抢购商品的库存实际是存在库存表中
的。为了提高抢购性能，我们通常会将库存存放在缓存中，通过缓存中的库存来实现库存的
精确扣减。在提交订单并付款之后，我们还需要再去扣除数据库中的库存。如果遇到瞬时高
并发，我们还都去操作数据库的话，那么在单表单库的情况下，数据库就很可能会出现性能
瓶颈。

而我们库存表如果要实现分库分表，势必会增加业务的复杂度。试想一个商品的库存分别在
不同库的表中，我们在扣除库存时，又该如何判断去哪个库中扣除呢？

如果随意扣除表中库存，那么就会出现有些表已经扣完了，有些表中还有库存的情况，这样
的操作显然是不合理的，此时就需要额外增加逻辑判断来解决问题。

在不分库分表的情况下，为了提高订单中扣除库存业务的性能以及吞吐量，我们就可以采用
生产者消费者模式来实现系统的性能优化。

创建订单等于生产者，存放订单的队列则是缓冲容器，而从队列中消费订单则是数据库扣除
库存操作。其中存放订单的队列可以极大限度地缓冲高并发给数据库带来的压力。

我们还可以基于消息队列来实现生产者消费者模式，如今 RabbitMQ、RocketMQ 都实现
了事务，我们只需要将订单通过事务提交到 MQ 中，扣除库存的消费方只需要通过消费
MQ 来逐步操作数据库即可